name: Build and Deploy

on:

  push:

    branches:

      - master

jobs:

  build:
    permissions: write-all
    runs-on: windows-latest

    steps:

    - name: Checkout repository

      uses: actions/checkout@v2

    - name: Setup .NET

      uses: actions/setup-dotnet@v1

      with:

        dotnet-version: '6.0' # Update with the appropriate .NET version
      
    - name: Determine Release Version
      id: version
      run: echo "::set-output name=version::$(date +'%Y%m%d').$GITHUB_RUN_NUMBER"

    - name: Restore dependencies

      run: dotnet restore

    - name: Build application

      run: dotnet build --configuration Release

    - name: Publish application

      run: dotnet publish --configuration Release --output ./publish

    - name: Create Release

      id: create_release

      uses: actions/create-release@v1

      env:

        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      with:

        tag_name: ${{ steps.version.outputs.version }}

        release_name: Release ${{ steps.version.outputs.version }}
        draft: false

        prerelease: false

    - name: Upload artifact

      uses: actions/upload-release-asset@v1

      env:

        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      with:

        upload_url: ${{ steps.create_release.outputs.upload_url }}

        asset_path: ./publish/

        asset_name: Moorhuh_RLE2BMP.zip

        asset_content_type: application/zip

